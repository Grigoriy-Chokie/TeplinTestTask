"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){t=_toPrimitive(t,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(t,e){if("object"!==_typeof(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);r=r.call(t,e||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&_setPrototypeOf(t,e)}function _createSuper(r){var n=_isNativeReflectConstruct();return function(){var t,e=_getPrototypeOf(r);return _possibleConstructorReturn(this,n?(t=_getPrototypeOf(this).constructor,Reflect.construct(e,arguments,t)):e.apply(this,arguments))}}function _possibleConstructorReturn(t,e){if(e&&("object"===_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _wrapNativeSuper(t){var r="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(t){if(null===t||!_isNativeFunction(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(t))return r.get(t);r.set(t,e)}function e(){return _construct(t,arguments,_getPrototypeOf(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(e,t)})(t)}function _construct(t,e,r){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);e=new(Function.bind.apply(t,n));return r&&_setPrototypeOf(e,r.prototype),e}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _isNativeFunction(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}!function n(o,i,c){function u(e,t){if(!i[e]){if(!o[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(a)return a(e,!0);throw(t=new Error("Cannot find module '"+e+"'")).code="MODULE_NOT_FOUND",t}r=i[e]={exports:{}},o[e][0].call(r.exports,function(t){return u(o[e][1][t]||t)},r,r.exports,n,o,i,c)}return i[e].exports}for(var a="function"==typeof require&&require,t=0;t<c.length;t++)u(c[t]);return u}({1:[function(t,e,r){customElements.get("c-product-card")||customElements.define("c-product-card",function(){_inherits(r,_wrapNativeSuper(HTMLElement));var e=_createSuper(r);function r(){var t;return _classCallCheck(this,r),(t=e.call(this)).addToCart=t.addToCart.bind(_assertThisInitialized(t)),t}return _createClass(r,[{key:"connectedCallback",value:function(){this.cart=document.querySelector("cart-notification")||document.querySelector("cart-drawer"),this.addToCartButton=this.querySelector(".js-product-card__button"),this.addToCartButton?(this.variantId=this.dataset.variantId,this.addToCartButton.addEventListener("click",this.addToCart)):console.warn("Add-to-cart button not found")}},{key:"disconnectedCallback",value:function(){this.addToCartButton&&this.addToCartButton.removeEventListener("click",this.addToCart)}},{key:"addToCart",value:function(){var t,e,r=this;this.variantId?((t=fetchConfig("javascript")).headers["X-Requested-With"]="XMLHttpRequest",delete t.headers["Content-Type"],(e=new FormData).append("id",this.variantId),e.append("quantity",1),this.cart&&(e.append("sections",this.cart.getSectionsToRender().map(function(t){return t.id})),e.append("sections_url",window.location.pathname),this.cart.setActiveElement(document.activeElement)),t.body=e,this.addToCartButton.setAttribute("disabled","true"),fetch(routes.cart_add_url,t).then(function(t){return t.json()}).then(function(t){t.status?console.warn("Error adding to cart:",t.message||t.status):r.cart?r.cart.renderContents(t):window.location=window.routes.cart_url}).catch(function(t){console.error("Error while adding to cart:",t)}).finally(function(){r.addToCartButton.removeAttribute("disabled"),r.cart&&r.cart.classList.contains("is-empty")&&r.cart.classList.remove("is-empty")})):console.warn("Variant ID is not specified")}}]),r}())},{}]},{},[1]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvY29tcG9uZW50LXByb2R1Y3QtY2FyZC5qcyIsImNvbXBvbmVudC1wcm9kdWN0LWNhcmQuanMiXSwibmFtZXMiOlsiciIsImUiLCJuIiwidCIsIm8iLCJpIiwiZiIsImMiLCJyZXF1aXJlIiwidSIsImEiLCJFcnJvciIsImNvZGUiLCJwIiwiZXhwb3J0cyIsImNhbGwiLCJsZW5ndGgiLCIxIiwibW9kdWxlIiwiY3VzdG9tRWxlbWVudHMiLCJnZXQiLCJkZWZpbmUiLCJfaW5oZXJpdHMiLCJDb21wb25lbnRQcm9kdWN0Q2FyZCIsIl93cmFwTmF0aXZlU3VwZXIiLCJIVE1MRWxlbWVudCIsIl9zdXBlciIsIl9jcmVhdGVTdXBlciIsIl90aGlzIiwiX2NsYXNzQ2FsbENoZWNrIiwidGhpcyIsImFkZFRvQ2FydCIsImJpbmQiLCJfYXNzZXJ0VGhpc0luaXRpYWxpemVkIiwiX2NyZWF0ZUNsYXNzIiwia2V5IiwidmFsdWUiLCJjYXJ0IiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiYWRkVG9DYXJ0QnV0dG9uIiwidmFyaWFudElkIiwiZGF0YXNldCIsImFkZEV2ZW50TGlzdGVuZXIiLCJjb25zb2xlIiwid2FybiIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJjb25maWciLCJmb3JtRGF0YSIsIl90aGlzMiIsImZldGNoQ29uZmlnIiwiaGVhZGVycyIsIkZvcm1EYXRhIiwiYXBwZW5kIiwiZ2V0U2VjdGlvbnNUb1JlbmRlciIsIm1hcCIsInNlY3Rpb24iLCJpZCIsIndpbmRvdyIsImxvY2F0aW9uIiwicGF0aG5hbWUiLCJzZXRBY3RpdmVFbGVtZW50IiwiYWN0aXZlRWxlbWVudCIsImJvZHkiLCJzZXRBdHRyaWJ1dGUiLCJmZXRjaCIsInJvdXRlcyIsImNhcnRfYWRkX3VybCIsInRoZW4iLCJyZXNwb25zZSIsImpzb24iLCJzdGF0dXMiLCJtZXNzYWdlIiwicmVuZGVyQ29udGVudHMiLCJjYXJ0X3VybCIsImVycm9yIiwicmVtb3ZlQXR0cmlidXRlIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJyZW1vdmUiXSwibWFwcGluZ3MiOiI4NUdBQUEsQ0FBQSxTQUFBQSxFQUFBQyxFQUFBQyxFQUFBQyxHQUFBLFNBQUFDLEVBQUFDLEVBQUFDLEdBQUEsR0FBQSxDQUFBSixFQUFBRyxHQUFBLENBQUEsR0FBQSxDQUFBSixFQUFBSSxHQUFBLENBQUEsSUFBQUUsRUFBQSxZQUFBLE9BQUFDLFNBQUFBLFFBQUEsR0FBQSxDQUFBRixHQUFBQyxFQUFBLE9BQUFBLEVBQUFGLEVBQUEsQ0FBQSxDQUFBLEVBQUEsR0FBQUksRUFBQSxPQUFBQSxFQUFBSixFQUFBLENBQUEsQ0FBQSxFQUFBLE1BQUFLLEVBQUEsSUFBQUMsTUFBQSx1QkFBQU4sRUFBQSxHQUFBLEdBQUFPLEtBQUEsbUJBQUFGLENBQUEsQ0FBQUcsRUFBQVgsRUFBQUcsR0FBQSxDQUFBUyxRQUFBLEVBQUEsRUFBQWIsRUFBQUksR0FBQSxHQUFBVSxLQUFBRixFQUFBQyxRQUFBLFNBQUFkLEdBQUEsT0FBQUksRUFBQUgsRUFBQUksR0FBQSxHQUFBTCxJQUFBQSxDQUFBLENBQUEsRUFBQWEsRUFBQUEsRUFBQUMsUUFBQWQsRUFBQUMsRUFBQUMsRUFBQUMsQ0FBQSxDQUFBLENBQUEsT0FBQUQsRUFBQUcsR0FBQVMsT0FBQSxDQUFBLElBQUEsSUFBQUwsRUFBQSxZQUFBLE9BQUFELFNBQUFBLFFBQUFILEVBQUEsRUFBQUEsRUFBQUYsRUFBQWEsT0FBQVgsQ0FBQSxHQUFBRCxFQUFBRCxFQUFBRSxFQUFBLEVBQUEsT0FBQUQsQ0FBQSxFQUFBLENBQUFhLEVBQUEsQ0FBQSxTQUFBVCxFQUFBVSxFQUFBSixHQ0FBSyxlQUFBQyxJQUFBLGdCQUFBLEdBQ0FELGVBQUFFLE9BQUEsaUJBQUEsV0FBQUMsVUFBQUMsRUFzRkFDLGlCQXRGQUMsV0FBQSxDQUFBLEVBQUEsSUFBQUMsRUFBQUMsYUFBQUosQ0FBQSxFQUNBLFNBQUFBLElBQUEsSUFBQUssRUFFQSxPQUZBQyxnQkFBQUMsS0FBQVAsQ0FBQSxHQUNBSyxFQUFBRixFQUFBWCxLQUFBZSxJQUFBLEdBQ0FDLFVBQUFILEVBQUFHLFVBQUFDLEtBQUFDLHVCQUFBTCxDQUFBLENBQUEsRUFBQUEsQ0FDQSxDQWtGQSxPQWxGQU0sYUFBQVgsRUFBQSxDQUFBLENBQUFZLElBQUEsb0JBQUFDLE1BRUEsV0FFQU4sS0FBQU8sS0FBQUMsU0FBQUMsY0FBQSxtQkFBQSxHQUFBRCxTQUFBQyxjQUFBLGFBQUEsRUFHQVQsS0FBQVUsZ0JBQUFWLEtBQUFTLGNBQUEsMEJBQUEsRUFDQVQsS0FBQVUsaUJBQ0FWLEtBQUFXLFVBQUFYLEtBQUFZLFFBQUFELFVBQ0FYLEtBQUFVLGdCQUFBRyxpQkFBQSxRQUFBYixLQUFBQyxTQUFBLEdBRUFhLFFBQUFDLEtBQUEsOEJBQUEsQ0FFQSxDQUFBLEVBQUEsQ0FBQVYsSUFBQSx1QkFBQUMsTUFFQSxXQUVBTixLQUFBVSxpQkFDQVYsS0FBQVUsZ0JBQUFNLG9CQUFBLFFBQUFoQixLQUFBQyxTQUFBLENBRUEsQ0FBQSxFQUFBLENBQUFJLElBQUEsWUFBQUMsTUFFQSxXQUFBLElBT0FXLEVBSUFDLEVBWEFDLEVBQUFuQixLQUVBQSxLQUFBVyxZQUtBTSxFQUFBRyxZQUFBLFlBQUEsR0FDQUMsUUFBQSxvQkFBQSxpQkFDQSxPQUFBSixFQUFBSSxRQUFBLGlCQUVBSCxFQUFBLElBQUFJLFVBQ0FDLE9BQUEsS0FBQXZCLEtBQUFXLFNBQUEsRUFDQU8sRUFBQUssT0FBQSxXQUFBLENBQUEsRUFHQXZCLEtBQUFPLE9BQ0FXLEVBQUFLLE9BQ0EsV0FDQXZCLEtBQUFPLEtBQUFpQixvQkFBQSxFQUFBQyxJQUFBLFNBQUFDLEdBQUEsT0FBQUEsRUFBQUMsRUFBQSxDQUFBLENBQ0EsRUFDQVQsRUFBQUssT0FBQSxlQUFBSyxPQUFBQyxTQUFBQyxRQUFBLEVBQ0E5QixLQUFBTyxLQUFBd0IsaUJBQUF2QixTQUFBd0IsYUFBQSxHQUdBZixFQUFBZ0IsS0FBQWYsRUFHQWxCLEtBQUFVLGdCQUFBd0IsYUFBQSxXQUFBLE1BQUEsRUFFQUMsTUFBQUMsT0FBQUMsYUFBQXBCLENBQUEsRUFDQXFCLEtBQUEsU0FBQUMsR0FBQSxPQUFBQSxFQUFBQyxLQUFBLENBQUEsQ0FBQSxFQUNBRixLQUFBLFNBQUFDLEdBRUFBLEVBQUFFLE9BQ0EzQixRQUFBQyxLQUFBLHdCQUFBd0IsRUFBQUcsU0FBQUgsRUFBQUUsTUFBQSxFQUtBdEIsRUFBQVosS0FNQVksRUFBQVosS0FBQW9DLGVBQUFKLENBQUEsRUFMQVgsT0FBQUMsU0FBQUQsT0FBQVEsT0FBQVEsUUFNQSxDQUFBLEVBQUEsTUFDQSxTQUFBQyxHQUNBL0IsUUFBQStCLE1BQUEsOEJBQUFBLENBQUEsQ0FDQSxDQUFBLEVBQUEsUUFDQSxXQUVBMUIsRUFBQVQsZ0JBQUFvQyxnQkFBQSxVQUFBLEVBRUEzQixFQUFBWixNQUFBWSxFQUFBWixLQUFBd0MsVUFBQUMsU0FBQSxVQUFBLEdBQ0E3QixFQUFBWixLQUFBd0MsVUFBQUUsT0FBQSxVQUFBLENBRUEsQ0FBQSxHQXZEQW5DLFFBQUFDLEtBQUEsNkJBQUEsQ0F3REEsQ0FBQSxFQUFBLEVBQUF0QixDQUFBLEVBdEZBLENBdUZBLENDSUEsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEVEcERYeUIiLCJmaWxlIjoiY29tcG9uZW50LXByb2R1Y3QtY2FyZC5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCJpZiAoIWN1c3RvbUVsZW1lbnRzLmdldCgnYy1wcm9kdWN0LWNhcmQnKSkge1xyXG4gIGN1c3RvbUVsZW1lbnRzLmRlZmluZSgnYy1wcm9kdWN0LWNhcmQnLCBjbGFzcyBDb21wb25lbnRQcm9kdWN0Q2FyZCBleHRlbmRzIEhUTUxFbGVtZW50IHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICBzdXBlcigpO1xyXG4gICAgICB0aGlzLmFkZFRvQ2FydCA9IHRoaXMuYWRkVG9DYXJ0LmJpbmQodGhpcyk7IC8vIEJpbmQgdGhlIG1ldGhvZCB0byB0aGUgY3VycmVudCBpbnN0YW5jZVxyXG4gICAgfVxyXG5cclxuICAgIGNvbm5lY3RlZENhbGxiYWNrKCkge1xyXG4gICAgICAvLyBGaW5kIHRoZSBjYXJ0IGNvbXBvbmVudCAoY2FydC1ub3RpZmljYXRpb24gb3IgY2FydC1kcmF3ZXIpXHJcbiAgICAgIHRoaXMuY2FydCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhcnQtbm90aWZpY2F0aW9uJykgfHwgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignY2FydC1kcmF3ZXInKTtcclxuXHJcbiAgICAgIC8vIEVuc3VyZSB0aGUgYnV0dG9uIGV4aXN0c1xyXG4gICAgICB0aGlzLmFkZFRvQ2FydEJ1dHRvbiA9IHRoaXMucXVlcnlTZWxlY3RvcihcIi5qcy1wcm9kdWN0LWNhcmRfX2J1dHRvblwiKTtcclxuICAgICAgaWYgKHRoaXMuYWRkVG9DYXJ0QnV0dG9uKSB7XHJcbiAgICAgICAgdGhpcy52YXJpYW50SWQgPSB0aGlzLmRhdGFzZXQudmFyaWFudElkO1xyXG4gICAgICAgIHRoaXMuYWRkVG9DYXJ0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmFkZFRvQ2FydCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKFwiQWRkLXRvLWNhcnQgYnV0dG9uIG5vdCBmb3VuZFwiKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGRpc2Nvbm5lY3RlZENhbGxiYWNrKCkge1xyXG4gICAgICAvLyBSZW1vdmUgdGhlIGV2ZW50IGxpc3RlbmVyIGZvciB0aGUgYnV0dG9uIHdoZW4gdGhlIGVsZW1lbnQgaXMgZGlzY29ubmVjdGVkXHJcbiAgICAgIGlmICh0aGlzLmFkZFRvQ2FydEJ1dHRvbikge1xyXG4gICAgICAgIHRoaXMuYWRkVG9DYXJ0QnV0dG9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLmFkZFRvQ2FydCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBhZGRUb0NhcnQoKSB7XHJcbiAgICAgIC8vIENoZWNrIGlmIHRoZSB2YXJpYW50IElEIGlzIHByZXNlbnRcclxuICAgICAgaWYgKCF0aGlzLnZhcmlhbnRJZCkge1xyXG4gICAgICAgIGNvbnNvbGUud2FybihcIlZhcmlhbnQgSUQgaXMgbm90IHNwZWNpZmllZFwiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGNvbmZpZyA9IGZldGNoQ29uZmlnKCdqYXZhc2NyaXB0Jyk7XHJcbiAgICAgIGNvbmZpZy5oZWFkZXJzWydYLVJlcXVlc3RlZC1XaXRoJ10gPSAnWE1MSHR0cFJlcXVlc3QnO1xyXG4gICAgICBkZWxldGUgY29uZmlnLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddO1xyXG5cclxuICAgICAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgZm9ybURhdGEuYXBwZW5kKFwiaWRcIiwgdGhpcy52YXJpYW50SWQpO1xyXG4gICAgICBmb3JtRGF0YS5hcHBlbmQoXCJxdWFudGl0eVwiLCAxKTtcclxuXHJcbiAgICAgIC8vIElmIHRoZSBjYXJ0IGNvbXBvbmVudCBleGlzdHMsIGFkZCBuZWNlc3NhcnkgZGF0YVxyXG4gICAgICBpZiAodGhpcy5jYXJ0KSB7XHJcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKFxyXG4gICAgICAgICAgJ3NlY3Rpb25zJyxcclxuICAgICAgICAgIHRoaXMuY2FydC5nZXRTZWN0aW9uc1RvUmVuZGVyKCkubWFwKChzZWN0aW9uKSA9PiBzZWN0aW9uLmlkKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgZm9ybURhdGEuYXBwZW5kKCdzZWN0aW9uc191cmwnLCB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUpO1xyXG4gICAgICAgIHRoaXMuY2FydC5zZXRBY3RpdmVFbGVtZW50KGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBjb25maWcuYm9keSA9IGZvcm1EYXRhO1xyXG5cclxuICAgICAgLy8gRGlzYWJsZSB0aGUgYnV0dG9uIHRvIHByZXZlbnQgbXVsdGlwbGUgY2xpY2tzXHJcbiAgICAgIHRoaXMuYWRkVG9DYXJ0QnV0dG9uLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCBcInRydWVcIik7XHJcblxyXG4gICAgICBmZXRjaChyb3V0ZXMuY2FydF9hZGRfdXJsLCBjb25maWcpXHJcbiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XHJcbiAgICAgICAgICAvLyBIYW5kbGUgZXJyb3Igc3RhdHVzXHJcbiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihcIkVycm9yIGFkZGluZyB0byBjYXJ0OlwiLCByZXNwb25zZS5tZXNzYWdlIHx8IHJlc3BvbnNlLnN0YXR1cyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAvLyBSZWRpcmVjdCB0byB0aGUgY2FydCBpZiBubyBjYXJ0IGNvbXBvbmVudCBleGlzdHNcclxuICAgICAgICAgIGlmICghdGhpcy5jYXJ0KSB7XHJcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IHdpbmRvdy5yb3V0ZXMuY2FydF91cmw7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAvLyBSZW5kZXIgdGhlIHVwZGF0ZWQgY2FydCBjb250ZW50XHJcbiAgICAgICAgICB0aGlzLmNhcnQucmVuZGVyQ29udGVudHMocmVzcG9uc2UpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHdoaWxlIGFkZGluZyB0byBjYXJ0OlwiLCBlcnJvcik7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgICAgICAvLyBSZS1lbmFibGUgdGhlIGJ1dHRvbiBhbmQgdXBkYXRlIHRoZSBjYXJ0IHN0YXRlXHJcbiAgICAgICAgICB0aGlzLmFkZFRvQ2FydEJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoJ2Rpc2FibGVkJyk7XHJcblxyXG4gICAgICAgICAgaWYgKHRoaXMuY2FydCAmJiB0aGlzLmNhcnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdpcy1lbXB0eScpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2FydC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1lbXB0eScpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcbiIsIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkoezE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpe1xuaWYgKCFjdXN0b21FbGVtZW50cy5nZXQoJ2MtcHJvZHVjdC1jYXJkJykpIHtcclxuICBjdXN0b21FbGVtZW50cy5kZWZpbmUoJ2MtcHJvZHVjdC1jYXJkJywgY2xhc3MgQ29tcG9uZW50UHJvZHVjdENhcmQgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgc3VwZXIoKTtcclxuICAgICAgdGhpcy5hZGRUb0NhcnQgPSB0aGlzLmFkZFRvQ2FydC5iaW5kKHRoaXMpOyAvLyBCaW5kIHRoZSBtZXRob2QgdG8gdGhlIGN1cnJlbnQgaW5zdGFuY2VcclxuICAgIH1cclxuXHJcbiAgICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcclxuICAgICAgLy8gRmluZCB0aGUgY2FydCBjb21wb25lbnQgKGNhcnQtbm90aWZpY2F0aW9uIG9yIGNhcnQtZHJhd2VyKVxyXG4gICAgICB0aGlzLmNhcnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdjYXJ0LW5vdGlmaWNhdGlvbicpIHx8IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2NhcnQtZHJhd2VyJyk7XHJcblxyXG4gICAgICAvLyBFbnN1cmUgdGhlIGJ1dHRvbiBleGlzdHNcclxuICAgICAgdGhpcy5hZGRUb0NhcnRCdXR0b24gPSB0aGlzLnF1ZXJ5U2VsZWN0b3IoXCIuanMtcHJvZHVjdC1jYXJkX19idXR0b25cIik7XHJcbiAgICAgIGlmICh0aGlzLmFkZFRvQ2FydEJ1dHRvbikge1xyXG4gICAgICAgIHRoaXMudmFyaWFudElkID0gdGhpcy5kYXRhc2V0LnZhcmlhbnRJZDtcclxuICAgICAgICB0aGlzLmFkZFRvQ2FydEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5hZGRUb0NhcnQpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnNvbGUud2FybihcIkFkZC10by1jYXJ0IGJ1dHRvbiBub3QgZm91bmRcIik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBkaXNjb25uZWN0ZWRDYWxsYmFjaygpIHtcclxuICAgICAgLy8gUmVtb3ZlIHRoZSBldmVudCBsaXN0ZW5lciBmb3IgdGhlIGJ1dHRvbiB3aGVuIHRoZSBlbGVtZW50IGlzIGRpc2Nvbm5lY3RlZFxyXG4gICAgICBpZiAodGhpcy5hZGRUb0NhcnRCdXR0b24pIHtcclxuICAgICAgICB0aGlzLmFkZFRvQ2FydEJ1dHRvbi5yZW1vdmVFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy5hZGRUb0NhcnQpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgYWRkVG9DYXJ0KCkge1xyXG4gICAgICAvLyBDaGVjayBpZiB0aGUgdmFyaWFudCBJRCBpcyBwcmVzZW50XHJcbiAgICAgIGlmICghdGhpcy52YXJpYW50SWQpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oXCJWYXJpYW50IElEIGlzIG5vdCBzcGVjaWZpZWRcIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBjb25maWcgPSBmZXRjaENvbmZpZygnamF2YXNjcmlwdCcpO1xyXG4gICAgICBjb25maWcuaGVhZGVyc1snWC1SZXF1ZXN0ZWQtV2l0aCddID0gJ1hNTEh0dHBSZXF1ZXN0JztcclxuICAgICAgZGVsZXRlIGNvbmZpZy5oZWFkZXJzWydDb250ZW50LVR5cGUnXTtcclxuXHJcbiAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgIGZvcm1EYXRhLmFwcGVuZChcImlkXCIsIHRoaXMudmFyaWFudElkKTtcclxuICAgICAgZm9ybURhdGEuYXBwZW5kKFwicXVhbnRpdHlcIiwgMSk7XHJcblxyXG4gICAgICAvLyBJZiB0aGUgY2FydCBjb21wb25lbnQgZXhpc3RzLCBhZGQgbmVjZXNzYXJ5IGRhdGFcclxuICAgICAgaWYgKHRoaXMuY2FydCkge1xyXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZChcclxuICAgICAgICAgICdzZWN0aW9ucycsXHJcbiAgICAgICAgICB0aGlzLmNhcnQuZ2V0U2VjdGlvbnNUb1JlbmRlcigpLm1hcCgoc2VjdGlvbikgPT4gc2VjdGlvbi5pZClcclxuICAgICAgICApO1xyXG4gICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnc2VjdGlvbnNfdXJsJywgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lKTtcclxuICAgICAgICB0aGlzLmNhcnQuc2V0QWN0aXZlRWxlbWVudChkb2N1bWVudC5hY3RpdmVFbGVtZW50KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgY29uZmlnLmJvZHkgPSBmb3JtRGF0YTtcclxuXHJcbiAgICAgIC8vIERpc2FibGUgdGhlIGJ1dHRvbiB0byBwcmV2ZW50IG11bHRpcGxlIGNsaWNrc1xyXG4gICAgICB0aGlzLmFkZFRvQ2FydEJ1dHRvbi5zZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJywgXCJ0cnVlXCIpO1xyXG5cclxuICAgICAgZmV0Y2gocm91dGVzLmNhcnRfYWRkX3VybCwgY29uZmlnKVxyXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4ge1xyXG4gICAgICAgICAgLy8gSGFuZGxlIGVycm9yIHN0YXR1c1xyXG4gICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cykge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJFcnJvciBhZGRpbmcgdG8gY2FydDpcIiwgcmVzcG9uc2UubWVzc2FnZSB8fCByZXNwb25zZS5zdGF0dXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgLy8gUmVkaXJlY3QgdG8gdGhlIGNhcnQgaWYgbm8gY2FydCBjb21wb25lbnQgZXhpc3RzXHJcbiAgICAgICAgICBpZiAoIXRoaXMuY2FydCkge1xyXG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSB3aW5kb3cucm91dGVzLmNhcnRfdXJsO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgLy8gUmVuZGVyIHRoZSB1cGRhdGVkIGNhcnQgY29udGVudFxyXG4gICAgICAgICAgdGhpcy5jYXJ0LnJlbmRlckNvbnRlbnRzKHJlc3BvbnNlKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB3aGlsZSBhZGRpbmcgdG8gY2FydDpcIiwgZXJyb3IpO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICAgICAgLy8gUmUtZW5hYmxlIHRoZSBidXR0b24gYW5kIHVwZGF0ZSB0aGUgY2FydCBzdGF0ZVxyXG4gICAgICAgICAgdGhpcy5hZGRUb0NhcnRCdXR0b24ucmVtb3ZlQXR0cmlidXRlKCdkaXNhYmxlZCcpO1xyXG5cclxuICAgICAgICAgIGlmICh0aGlzLmNhcnQgJiYgdGhpcy5jYXJ0LmNsYXNzTGlzdC5jb250YWlucygnaXMtZW1wdHknKSkge1xyXG4gICAgICAgICAgICB0aGlzLmNhcnQuY2xhc3NMaXN0LnJlbW92ZSgnaXMtZW1wdHknKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cbn0se31dfSx7fSxbMV0pXG5cbiJdfQ==
